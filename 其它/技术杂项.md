# 目录
[TOC]

# 压测工具 wrk

安装： brew install wrk

// 开200个线程，每个线程200个连接，总共测试5s。user_random.lua 是lua脚本，可以动态设置一些请求参数
counter = 0

request = function()

    counter = math.random(0, 10000000)

    local data = [[{
        "username": "u%d",
        "token": "entry_task_test_token"
    }]]

    wrk.body = string.format(data, counter)
    wrk.method = "POST"
    wrk.headers["Content-Type"] = "application/json"
    return wrk.format("POST", "/v1/user/info/query")
end

测试：wrk -t200 -c200 -d10s --latency --timeout 5s -s user_random.lua http://192.168.33.10.8080

# 生成rsa
1、生成私钥： openssl genrsa -out rsa_private_key.pem 2048
2、转换为pkcs8: openssl pkcs8 -topk8 -inform PEM -in nolive_rsa_private_key.pem -outform PEM -nocrypt -out nolive_rsa_private_pkcs8.pem
3、去除首尾部分后base64编码
4、执行代码，报错 x509.ParsePKCS8PrivateKey

# 安装pip
sudo easy_install pip

升级pip
sudo -H pip install --upgrade pip

卸载pip
sudo pip uninstall pip

安装vituralenv
sudo pip install virtualenv

创建一个虚拟环境 venv(pycharm 不要使用命令行创建，直接使用ide创建)
virtualenv --python=python2.7 --no-site-packages venv

安装pycharm
https://www.jianshu.com/p/dc396a37ddee

安装mysql
brew install mysql

安装第三方依赖库
brew install freetds
sudo pip install pymssql

安装其它依赖库
sudo pip install --user -r deploy/requirements/requirements.txt --default-timeout=1000

pip install -r deploy/requirements/requirements.txt --default-timeout=1000

sudo pip install --user netifaces

安装django环境
sudo -H pip install Django

sudo ln -s /Users/dongdongliao/workspace/python/git.garena.com/core-services/beepay_server/beepay_server /var/www/beepay_server/current

ln -s /Users/dongdongliao/workspace/python/git.garena.com/core-services/python_common /Users/dongdongliao/workspace/python/git.garena.com/core-services/beepay_server/beepay_server/common

unlink /Users/dongdongliao/workspace/python/git.garena.com/core-services/beepay_server/beepay_server/common

Pycharm 中提示找不到模块，但是编译可以正常通过，而且正常执行
pycharm不会将当前文件目录自动加入自己的sourse_path。右键make_directory as-->sources root将当前工作的文件夹加入source_path就可以了。


192.168.33.10
202.104.118.215

scp -r /Users/dongdongliao/workspace/python/git.garena.com/core-services/beepay_server/beepay_server/deploy/nginx/th/ssl root@192.168.33.10:/usr/local/openresty/nginx


brew uninstall mysql
brew install mysql-connector-c

pip install mysql-python

sudo apt-get install libmysqlclient-dev


brew unlink mysql-connector-c
brew install mysql

遇到找不到lssl时
brew link openssl --force（根据提示，执行提示中的命令，重启终端）

在虚拟环境中使用如下命令安装mysql-python
env LDFLAGS="-I/usr/local/opt/openssl/include -L/usr/local/opt/openssl/lib" pip install mysql-python


虚拟环境
env LDFLAGS="-I/usr/local/opt/openssl/include -L/usr/local/opt/openssl/lib" sudo pip install —user mysqlclient

本机环境
env LDFLAGS="-I/usr/local/Cellar/openssl/1.0.2s -L/usr/local/Cellar/openssl/1.0.2s/lib" sudo pip install —user mysqlclient

# 文件下载
scp root@203.116.124.61:/var/www/beepay_server/current/thirdpartylib/im_server/bill/sandbox/bill_config.csv /Users/dongdongliao/workspace/

# vagrant 命令
vagrant up 启动虚拟机
vagrant destroy 销毁虚拟机
vagrant halt 关闭虚拟化开发环境
vagrant reload 修改配置文件后，重启虚拟化开发环境
vagrant box list 查看当前可用的虚拟化开发环境
vagrant box add box-name box-file 添加指定的box环境
vagrant box remove box-name 删除指定的box环境
vagrant package 当前正在运行的VirtualBox虚拟环境打包成一个可重复使用的box

# 开机自启动mysql
1、编辑一个mysql启动文件。
在终端里面输入：    
sudo vi /Library/LaunchDaemons/com.mysql.mysql.plist

2、输入启动文件内容：
<?xml version="1.0" encoding="UTF-8"?>    
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">    
<plist version="1.0">    
  <dict>    
    <key>KeepAlive</key>    
    <true/>    
    <key>Label</key>    
    <string>com.mysql.mysqld</string>    
    <key>ProgramArguments</key>    
    <array>    
    <string>/usr/local/Cellar/mysql/5.7.20/bin/mysqld_safe</string>    
    <string>--user=root</string>    
    </array>      
  </dict>    
</plist>

上面xml中的 /usr/local/Cellar/mysql/5.7.20/bin/mysqld_safe 为我的mysql所在目录。
这个是通过homebrew下载的mysql。
官方下载的路径为 /usr/local/mysql/bin/mysqld_safe


3、加载这个启动文件
在终端里输入：
sudo launchctl load -w /Library/LaunchDaemons/com.mysql.mysql.plist  
这样你就会发现mysql成功启动了。
ps -aef | grep mysql


mysql 本地密码 qweqwe

登录报错
连接不上MySQL 报错解决办法2059 - Authentication plugin 'caching_sha2_password' cannot be loaded: dlopen(../Frameworks/caching_sha2_password.so, 2): image not found

是因为没有设置root密码，无密码登录到mysql后，执行下面语句

ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY '你的密码';

Kafka 日常操作

# 查看消费者组列表
bin/kafka-consumer-groups.sh --bootstrap-server kafka.public-1-staging.ap-sg-1-general-c.staging.mq.shopee.io:9093 --list

查看某个消费者组详细信息（消费组，消费topic，消费分区，lag等信息）
bin/kafka-consumer-groups.sh --bootstrap-server kafka.public-1-staging.ap-sg-1-general-c.staging.mq.shopee.io:9093 --describe --group dp_item_raw_data_common_info_id_staging_group_kqf_pfb-item-home-service

# iterm2 设置

1、 Iterm2 修改命令行头部显示信息
echo $PS1备份
LDD-MBP@%{$fg[magenta]%}%(?..%?%1v)%n:%{$reset_color%}%{$fg[cyan]%}%~#

cd /Users/dongdongliao/.oh-my-zsh/themes
cp robbyrussell.zsh-theme myrobbyrussell.zsh-theme
vi myrobbyrussell.zsh-theme
修改:  PROMPT='LDD-MBP@%{$fg[magenta]%}%(?..%?%1v)%n:%{$reset_color%}%{$fg[cyan]%}%~#'
vi ~/.zshrc
修改：ZSH_THEME="myrobbyrussell"

2、设置为“不显示全路径”
vi /Users/dongdongliao/.oh-my-zsh/themes/myrobbyrussell.zsh-theme
PROMPT='LDD-MBP@%{$fg[magenta]%}%(?..%?%1v)%n:%{$fg[cyan]%}%c%{$reset_color%}#'

# 提取日志中的关键字

awk -F"[| ,]" '{print $1,$2,$11}' temp.log


删除字符串中倒数n个字符（把n换成具体的数字）
awk '{sub(/.{n}$/,””)}1’ ret.log

替换字符串的中子字符串


cat api.txt|awk -F'|' '{print $4,length($0)}' |awk '{sum[$1]+=$2;count[$1]+=1;allsum+=$2} END{for (i in sum) {if(sum[i]/allsum > 0.0001) print i, count[i],sum[i]/count[i],sum[i]/allsum}}'|sort -nr -k4 > api-res.txt

cat item.txt|awk -F'|' '{print $4,length($0)}' |awk '{sum[$1]+=$2;count[$1]+=1;allsum+=$2} END{for (i in sum) {if(sum[i]/allsum > 0.0001) print i, count[i],sum[i]/count[i],sum[i]/allsum}}'|sort -nr -k4 > item-res.txt

awk '{ gsub(/\\t/,"|"); print $0 }' realtimecomputing.txt > realtimecomputing-after.txt


awk '{ gsub(/\\t/,"|"); print $0 }'

cat realtimecomputing.txt | awk -F'|' '{print $3,length($0)}' |awk '{sum[$1]+=$2;count[$1]+=1;allsum+=$2} END{for (i in sum) {if(sum[i]/allsum > 0.0001) print i, count[i],sum[i]/count[i],sum[i]/allsum}}'|sort -nr -k4 > realtimecomputing-res.txt

cat real-500.txt | awk -F'|' '{print $3,length($0)}'

cat onlinedatasync.txt | awk -F'|' '{print $3,length($0)}' |awk '{sum[$1]+=$2;count[$1]+=1;allsum+=$2} END{for (i in sum) {if(sum[i]/allsum > 0.0001) print i, count[i],sum[i]/count[i],sum[i]/allsum}}'|sort -nr -k4 > onlinedatasync-res.txt

cat essynchronizer.txt | awk -F'|' '{print $4,length($0)}' |awk '{sum[$1]+=$2;count[$1]+=1;allsum+=$2} END{for (i in sum) {if(sum[i]/allsum > 0.0001) print i, count[i],sum[i]/count[i],sum[i]/allsum}}'|sort -nr -k4 > essynchronizer-res.txt


head -n 500 api.txt > api-temp.txt

head -n 10000 realtimecomputing.txt > realtimecomputing-temp.txt

# 正则
grep -o -E "(\bcostTime=\b[1-9]\d*\.?\d*)|(\bcostTime=\b0\.\d*[1-9])"  test.txt > t.txt